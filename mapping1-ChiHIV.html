<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Yoon Hong Park" />


<title>Chicago HIV Prevalence Mapping</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("section-TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Yoon's Archive</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="about.html">Home</a>
</li>
<li>
  <a href="about.html">About me</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Program Evaluation (R/Stata)
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="PE_pset3.html">Ban the Box (DID)</a>
    </li>
    <li>
      <a href="PS2-f2018.html">Very Low Birth Weight (RDD)</a>
    </li>
    <li>
      <a href="pePS1.html">Mexican Universal Health Insurance (ITT/LATE)</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    GIS and Spatial Analysis (R)
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="mapping3-ChiTrauma.html">Chicago Trauma Center Service Area</a>
    </li>
    <li>
      <a href="mapping2-ILInc.html">Illinois Income Distribution</a>
    </li>
    <li>
      <a href="mapping1-ChiHIV.html">Chicago HIV Prevalence</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Policy Analysis (R)
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Rps4.html">Health Care Data</a>
    </li>
    <li>
      <a href="Rps3.html">Flight Data 2</a>
    </li>
    <li>
      <a href="Rps2.html">Flight Data 1</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Programming (Python)
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Scraping</li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="section-header">



<h1 class="title toc-ignore">Chicago HIV Prevalence Mapping</h1>
<h4 class="author"><em>Yoon Hong Park</em></h4>
<h4 class="date"><em>July 6, 2018</em></h4>

</div>


<p><br><br></p>
<p>This project was one of three assignments from the “Introduction to GIS and Spatial Analysis for Social Scientists” course taught by Dr. Marynia Kolak. It was to design a map using data from <a href="https://www.chicagohealthatlas.org/">Chicago Health Atlas</a>. Among several health indicators, “HIV Prevalence Rate” was chosen for this project. While the HIV data was downloaded from Chicago Health Atlas, the shapefile of Chicago with community area boundaries was from the <a href="https://data.cityofchicago.org/">City of Chicago Data Portal</a>. Originally, I used GeoDa for mapping, but as I found out that mapping with R could give me more fine-tuned maps, I decided to redo this project with R.</p>
<p><br><br></p>
<div id="section-basic-setup" class="section level2">
<h2><strong>Basic Setup</strong></h2>
<p><br></p>
<div id="section-load-libraries" class="section level3">
<h3><strong>Load Libraries</strong></h3>
<pre class="r"><code>library(rgdal)</code></pre>
<pre><code>## Loading required package: sp</code></pre>
<pre><code>## rgdal: version: 1.3-4, (SVN revision 766)
##  Geospatial Data Abstraction Library extensions to R successfully loaded
##  Loaded GDAL runtime: GDAL 2.2.3, released 2017/11/20
##  Path to GDAL shared files: C:/Users/yhth9/Documents/R/win-library/3.5/rgdal/gdal
##  GDAL binary built with GEOS: TRUE 
##  Loaded PROJ.4 runtime: Rel. 4.9.3, 15 August 2016, [PJ_VERSION: 493]
##  Path to PROJ.4 shared files: C:/Users/yhth9/Documents/R/win-library/3.5/rgdal/proj
##  Linking to sp version: 1.3-1</code></pre>
<pre class="r"><code>library(rgeos)</code></pre>
<pre><code>## rgeos version: 0.3-28, (SVN revision 572)
##  GEOS runtime version: 3.6.1-CAPI-1.10.1 r0 
##  Linking to sp version: 1.3-1 
##  Polygon checking: TRUE</code></pre>
<pre class="r"><code>library(tmap)
library(leaflet)
library(RColorBrewer)</code></pre>
<p><br></p>
</div>
<div id="section-load-the-hiv-data" class="section level3">
<h3><strong>Load the HIV data</strong></h3>
<pre class="r"><code>Census.Data &lt;- read.csv(&quot;HIV_prevalence.csv&quot;)

head(Census.Data)</code></pre>
<pre><code>##    Category        SubCategory      Indicator Year      Geography
## 1 Morbidity Infectious Disease HIV prevalence 2014 Community Area
## 2 Morbidity Infectious Disease HIV prevalence 2014 Community Area
## 3 Morbidity Infectious Disease HIV prevalence 2014 Community Area
## 4 Morbidity Infectious Disease HIV prevalence 2014 Community Area
## 5 Morbidity Infectious Disease HIV prevalence 2014 Community Area
## 6 Morbidity Infectious Disease HIV prevalence 2014 Community Area
##          Geo_Group Geo_ID Number Crude_Rate Lower_95CI_Crude_Rate
## 1    1-Rogers Park      1    932     1694.8                1586.0
## 2     2-West Ridge      2    297      412.8                 365.9
## 3         3-Uptown      3   1278     2267.5                2143.2
## 4 4-Lincoln Square      4    181      458.3                 391.5
## 5   5-North Center      5    108      338.9                 275.0
## 6       6-Lakeview      6    961     1018.4                 954.0
##   Upper_95CI_Crude_Rate Age_Adj_Rate Lower_95CI_Age_Adj_Rate
## 1                1803.6           NA                      NA
## 2                 459.8           NA                      NA
## 3                2391.8           NA                      NA
## 4                 525.1           NA                      NA
## 5                 402.8           NA                      NA
## 6                1082.7           NA                      NA
##   Upper_95CI_Age_Adj_Rate Percent Lower_95CI_Percent Upper_95CI_Percent
## 1                      NA      NA                 NA                 NA
## 2                      NA      NA                 NA                 NA
## 3                      NA      NA                 NA                 NA
## 4                      NA      NA                 NA                 NA
## 5                      NA      NA                 NA                 NA
## 6                      NA      NA                 NA                 NA
##   Weight_Number Weight_Percent Lower_95CI_Weight_Percent
## 1            NA             NA                        NA
## 2            NA             NA                        NA
## 3            NA             NA                        NA
## 4            NA             NA                        NA
## 5            NA             NA                        NA
## 6            NA             NA                        NA
##   Upper_95CI_Weight_Percent  Map_Key Flag
## 1                        NA Quintile    G
## 2                        NA Quintile    G
## 3                        NA Quintile    G
## 4                        NA Quintile    G
## 5                        NA Quintile    G
## 6                        NA Quintile    G</code></pre>
<p><br></p>
</div>
<div id="section-load-the-shapefile" class="section level3">
<h3><strong>Load the shapefile</strong></h3>
<pre class="r"><code>Output.Areas &lt;- readOGR(&quot;./Boundaries - Community Areas (current)&quot;, &quot;geo_export_33b739f8-cd83-43f1-a0a4-17c16a5a9d46&quot;)</code></pre>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: &quot;C:\Users\yhth9\Documents\2018.3 Summer\Intro to GIS\Assignment 1\Boundaries - Community Areas (current)&quot;, layer: &quot;geo_export_33b739f8-cd83-43f1-a0a4-17c16a5a9d46&quot;
## with 77 features
## It has 9 fields</code></pre>
<pre class="r"><code>head(Output.Areas)</code></pre>
<pre><code>## class       : SpatialPolygonsDataFrame 
## features    : 6 
## extent      : -87.7069, -87.58001, 41.79448, 41.99076  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=longlat +ellps=WGS84 +no_defs 
## variables   : 9
## names       : perimeter, community, shape_len, shape_area, area, comarea, area_numbe, area_num_1, comarea_id 
## min values  :         0,   DOUGLAS,  19565.51,   16913961,    0,       0,         35,         35,          0 
## max values  :         0,   OAKLAND,  36624.60,   71352328,    0,       0,          4,          4,          0</code></pre>
<p><br><br><br></p>
</div>
</div>
<div id="section-data-mergingcleaning" class="section level2">
<h2><strong>Data Merging/Cleaning</strong></h2>
<p><br></p>
<div id="section-merge-data-with-shapefile" class="section level3">
<h3><strong>Merge Data with Shapefile</strong></h3>
<p>By looking up the head part of both files, I noticed that the community area numbers were written in the “area_numbe” column in the shapefile and in the “Geo_ID” column in the HIV data. I merged these two data sets by using these column names.</p>
<pre class="r"><code>ChiCommArea &lt;- merge(Output.Areas, Census.Data, by.x=&quot;area_numbe&quot;, by.y=&quot;Geo_ID&quot;)

head(ChiCommArea)</code></pre>
<pre><code>## class       : SpatialPolygonsDataFrame 
## features    : 6 
## extent      : -87.7069, -87.58001, 41.79448, 41.99076  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=longlat +ellps=WGS84 +no_defs 
## variables   : 31
## names       : area_numbe, perimeter, community, shape_len, shape_area, area, comarea, area_num_1, comarea_id,  Category,        SubCategory,      Indicator, Year,      Geography,        Geo_Group, ... 
## min values  :         35,         0,   DOUGLAS,  19565.51,   16913961,    0,       0,         35,          0, Morbidity, Infectious Disease, HIV prevalence, 2014, Community Area,       35-Douglas, ... 
## max values  :          4,         0,   OAKLAND,  36624.60,   71352328,    0,       0,          4,          0, Morbidity, Infectious Disease, HIV prevalence, 2014, Community Area, 4-Lincoln Square, ...</code></pre>
<p><br></p>
<p>In this merged data set, the HIV prevalence rate was written in the “Crude_Rate” column. Before mapping, I checked if the data were numeric values or not.</p>
<pre class="r"><code>str(ChiCommArea$Crude_Rate)</code></pre>
<pre><code>##  num [1:77] 932 828 904 1245 846 ...</code></pre>
<p><br></p>
<p>The raw data was actually factor-type values, but while doing this project initially through GeoDa, I had already converted the data into numeric values. If it had been the same as the raw data, I should have needed to use as.numeric(as.character()) code.</p>
<p><br><br><br></p>
</div>
</div>
<div id="section-mapping" class="section level2">
<h2><strong>Mapping</strong></h2>
<p>First, I Created a map for quick overview.</p>
<pre class="r"><code>qtm(ChiCommArea, fill=&quot;Crude_Rate&quot;)</code></pre>
<pre><code>## Linking to GEOS 3.6.1, GDAL 2.2.3, proj.4 4.9.3</code></pre>
<p><img src="mapping1-ChiHIV_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p><br></p>
<p>From this quick overview, I realized that the variables were concentrated in the lower two intervals. With curiosity about how the variables were naturally clustered, I created another map using natural breaks rather than quantile. I also wanted to change the palette to shape this map aesthetically better.</p>
<pre class="r"><code>tm_shape(ChiCommArea) + 
  tm_fill(&quot;Crude_Rate&quot;, palette = &quot;BuPu&quot;, style = &quot;jenks&quot;)</code></pre>
<p><img src="mapping1-ChiHIV_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p><br></p>
<p>From the two maps above, I felt something special heppened in the northeastern side, so created another map with standard deviation.</p>
<pre class="r"><code>tm_shape(ChiCommArea) + 
  tm_fill(&quot;Crude_Rate&quot;, palette = &quot;BuPu&quot;, style = &quot;sd&quot;)</code></pre>
<p><img src="mapping1-ChiHIV_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p><br></p>
<p>While the standard deviation map clearly showed the outliers located in the northeastern side of Chicago, I chose the natural break map to see how those variables were geographically clustered as I could see twe clusters forming contours in addition to the cluster of outliers. (I used 6 bins for the assignment, but I find out that using 6 bins is better to distinguish regions by intervals.) Then, I changed the title of legend and added borders.</p>
<pre class="r"><code>tm_shape(ChiCommArea) + 
  tm_fill(&quot;Crude_Rate&quot;, palette = &quot;BuPu&quot;, style = &quot;jenks&quot;, title = &quot;HIV Prevalence Rate\n     (per 100,000 people)&quot;) + 
  tm_borders(alpha = .4)</code></pre>
<p><img src="mapping1-ChiHIV_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p><br></p>
<p>Then, I added a title, a legend, a compass, a scale-bar, and a source credit to this map. This was the final map of HIV Prevalence Rate in the City of Chicago.</p>
<pre class="r"><code>tm_shape(ChiCommArea) + 
  tm_fill(&quot;Crude_Rate&quot;, palette = &quot;BuPu&quot;, style = &quot;jenks&quot;, title = &quot;HIV Prevalence Rate\n     (per 100,000 people)&quot;) + 
  tm_borders(alpha = .4) +
  tm_compass(position = c(&quot;right&quot;, &quot;top&quot;)) + 
  tm_scale_bar(width = 0.15, position = c(&quot;right&quot;, &quot;top&quot;)) + 
  tm_credits(&quot;Source: Chicago Health Atlas \nChicago enhanced HIV/AIDS Reporting System(eHARS))&quot;, align = &quot;left&quot;, size = 0.7, position = c(&quot;left&quot;, &quot;bottom&quot;)) +
  tm_layout(
    outer.margins = 0,
    panel.show = TRUE,
    panel.labels = &quot;Chicago HIV Prevalence Rate (2015)&quot;,
    panel.label.bg.color = &quot;white&quot;,
    legend.position = c(&quot;left&quot;, &quot;center&quot;), 
    frame = FALSE)</code></pre>
<p><img src="mapping1-ChiHIV_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
